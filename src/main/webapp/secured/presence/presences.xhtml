<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:b="http://bootsfaces.net/ui">
    <ui:composition template="/template/main.xhtml">
        <ui:define name="contentTitle">#{msg.presence_presences}</ui:define>
        <ui:define name="contentSubtitle">#{msg.presence_presences_tip}</ui:define>
        <ui:define name="content">
            <h:form id="presencesForm">
                <b:panel>
                    <f:facet name="heading">
                        <h:outputText value="#{msg.filters}" />
                    </f:facet>
                    <b:panelGrid colSpans="2,4,2,4" size="md">
                        <h:outputLabel for="start" value="#{msg.startDate}" />
                        <b:dateTimePicker id="start"
                                          value="#{presenceListPresenter.start}"
                                          showTime="false"
                                          onblur="ajax:presenceListPresenter.updatePresences()"
                                          update="presencesList" />
                        <h:outputLabel for="end" value="#{msg.endDate}" />
                        <b:dateTimePicker id="end"
                                          value="#{presenceListPresenter.end}"
                                          showTime="false"
                                          onblur="ajax:presenceListPresenter.updatePresences()"
                                          update="presencesList" />
                    </b:panelGrid>
                    <br />
                    <b:panelGrid colSpans="2,4,2,4" size="md">
                        <h:outputLabel for="worker" value="#{msg.worker_worker}" />
                        <b:selectOneMenu id="worker"
                                         value="#{presenceListPresenter.worker}"
                                         onchange="ajax:presenceListPresenter.updatePresences()"
                                         update="presencesList">
                            <f:converter converterId="omnifaces.SelectItemsConverter" />
                            <f:selectItem itemLabel="#{msg.worker_worker_noSelection}" noSelectionOption="true"/>
                            <f:selectItems value="#{workerListPresenter.workers}"
                                           var="worker"
                                           itemLabel="#{worker.name}"
                                           itemValue="#{worker}"/>
                        </b:selectOneMenu>
                        <h:outputLabel for="onlyStart" value="#{msg.presence_presences_isPresenceNotEnded}" />
                        <b:switch id="onlyStart"
                                  value="#{presenceListPresenter.isPresenceNotEnded}"
                                  onchange="ajax:presenceListPresenter.updatePresences()"
                                  update="presencesList" />
                    </b:panelGrid>
                </b:panel>
                <br />
                <b:dataTable id="presencesList"
                             var="presence"
                             value="#{presenceListPresenter.presences}">
                    <b:dataTableColumn label="#{msg.worker_worker}"
                                       value="#{presence.worker.name}" />
                    <b:dataTableColumn label="#{msg.presence_presence_startTimestamp}"
                                       order-by="dom-text"
                                       dataType="date">
                        <h:outputText value="#{presence.startTimestamp}">
                            <f:convertDateTime type="both" timeStyle="short" />
                        </h:outputText>
                    </b:dataTableColumn>
                    <b:dataTableColumn label="#{msg.presence_presence_endTimestamp}">
                        <h:outputText value="#{presence.endTimestamp}">
                            <f:convertDateTime type="both" timeStyle="short" />
                        </h:outputText>
                    </b:dataTableColumn>
                    <b:dataTableColumn label="#{msg.presence_presence_notes}"
                                       value="#{presence.notes}"
                                       headerStyleClass="visible-lg"
                                       contentStyleClass="visible-lg"
                                       footerStyleClass="visible-lg" />
                    <b:dataTableColumn label="#{msg.actions}" orderable="false">
                        <b:button tooltip="#{msg.edit}"
                                  iconAwesome="pencil-square-o"
                                  outcome="/secured/presence/presence">
                            <f:param name="id" value="#{presence.id}" />
                        </b:button>
                        <b:dropButton value="âœ—"
                                      tooltip="#{msg.presence_presences_delete}"
                                      look="danger">
                            <b:navCommandLink value="#{msg.delete}"
                                              tooltip="#{msg.presence_presences_delete_tip}"
                                              actionListener="#{presenceListPresenter.deletePresence(presence.id)}"
                                              update="@form, globalMessages"/>
                        </b:dropButton>
                    </b:dataTableColumn>
                </b:dataTable>
            </h:form>
            <b:row>
                <b:button value="#{msg.new_female} #{msg.presence_presence}"
                          outcome="/secured/presence/presence"
                          look="primary"
                          styleClass="btn-block"
                          colXs="12" colSm="6" colMd="4" colLg="3">
                    <f:param name="id" value="0"/>
                </b:button>
            </b:row>
        </ui:define>
    </ui:composition>
</html>